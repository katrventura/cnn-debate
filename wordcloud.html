<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trump vs Biden Word Cloud</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-cloud/1.2.5/d3.layout.cloud.min.js"></script>
</head>

<script>
    function createWordCloud() {
        d3.json("filtered_word_count.json").then(function(data) {
            // Combine Trump and Biden data
            var combinedWords = data.data.map(d => ({
                text: d[0],
                size: d[1] + d[2],  // Sum of TRUMP and BIDEN counts
                trump: d[1],
                biden: d[2]
            }));

            // Set the dimensions and margins of the graph
            var margin = {top: 10, right: 10, bottom: 10, left: 10},
                width = 800 - margin.left - margin.right,
                height = 600 - margin.top - margin.bottom;

            // Append the svg object to the body of the page
            var svg = d3.select("#wordcloud").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            // Constructs a new cloud layout instance
            var layout = d3.layout.cloud()
                .size([width, height])
                .words(combinedWords)
                .padding(5)
                .rotate(function() { return ~~(Math.random() * 2) * 90; })
                .fontSize(function(d) { return Math.sqrt(d.size) * 10; })
                .on("end", draw);

            layout.start();

            // This function draws the words
            function draw(words) {
                var texts = svg.append("g")
                    .attr("transform", "translate(" + layout.size()[0] / 2 + "," + layout.size()[1] / 2 + ")")
                    .selectAll("text")
                    .data(words)
                    .enter().append("text")
                    .style("font-size", function(d) { return d.size + "px"; })
                    .style("fill", function(d) { 
                        // Color words based on which candidate used them more
                        if (d.trump > d.biden) return "#d30b0d";  // TRUMP
                        else if (d.biden > d.trump) return "#013364";  // BIDEN
                        else return "#643B9F"; // If used equally
                    })
                    .style("opacity", 1)
                    .attr("text-anchor", "middle")
                    .attr("transform", function(d) {
                        return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                    })
                    .text(function(d) { return d.text; });

                // Add scroll event listener
                var animated = false;
                window.addEventListener('scroll', function() {
                    var wordcloudElement = document.getElementById('wordcloud');
                    var wordcloudPosition = wordcloudElement.getBoundingClientRect().top;
                    var screenPosition = window.innerHeight / 1.3;

                    if (wordcloudPosition < screenPosition && !animated) {
                        animateWordCloud();
                        animated = true;
                        setInterval(animateWordCloud, 3000);
                    }
                });

                function animateWordCloud() {
                    texts.transition()
                        .duration(1000)
                        .attr("transform", function(d) {
                            var newX = d.x + (Math.random() - 0.5) * 50;
                            var newY = d.y + (Math.random() - 0.5) * 50;
                            return "translate(" + [newX, newY] + ")rotate(" + d.rotate + ")";
                        })
                        .transition()
                        .duration(1000)
                        .attr("transform", function(d) {
                            return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                        });
                }
            }
        });
    }

    // Call both functions when the page loads
    document.addEventListener('DOMContentLoaded', (event) => {
        createWordCloud();
    });
</script>


<body>
    <div class="article-body">
    <h1>Trump vs Biden Word Cloud</h1>
    <div id="wordcloud"></div>
    </div>

<style>
    .article-body {
        max-width: 800px;
        margin-left: 20%;
        margin-right: 20%;
    }

    #wordcloud {
        /* margin: 0 auto; */
    }

    #chart {
        margin: 0 auto;
        
    }
</style>
</body>
</html>