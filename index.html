<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trump vs Biden Word Cloud</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-cloud/1.2.5/d3.layout.cloud.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">

    <!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet">
</head>

<script>
    function createWordCloud() {
        d3.json("filtered_word_count.json").then(function(data) {
            // Combine Trump and Biden data
            var combinedWords = data.data.map(d => ({
                text: d[0],
                size: d[1] + d[2],  // Sum of TRUMP and BIDEN counts
                trump: d[1],
                biden: d[2]
            }));

            // Set the dimensions and margins of the graph
            var margin = {top: 10, right: 10, bottom: 10, left: 10},
                width = 800 - margin.left - margin.right,
                height = 600 - margin.top - margin.bottom;

            // Append the svg object to the body of the page
            var svg = d3.select("#wordcloud").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            // Constructs a new cloud layout instance
            var layout = d3.layout.cloud()
                .size([width, height])
                .words(combinedWords)
                .padding(5)
                .rotate(function() { return ~~(Math.random() * 2) * 90; })
                .fontSize(function(d) { return Math.sqrt(d.size) * 10; })
                .on("end", draw);

            layout.start();

            // This function draws the words
            function draw(words) {
                var texts = svg.append("g")
                    .attr("transform", "translate(" + layout.size()[0] / 2 + "," + layout.size()[1] / 2 + ")")
                    .selectAll("text")
                    .data(words)
                    .enter().append("text")
                    .style("font-size", function(d) { return d.size + "px"; })
                    .style("fill", function(d) { 
                        // Color words based on which candidate used them more
                        if (d.trump > d.biden) return "#d30b0d";  // TRUMP
                        else if (d.biden > d.trump) return "#013364";  // BIDEN
                        else return "#643B9F"; // If used equally
                    })
                    .style("opacity", 1)
                    .attr("text-anchor", "middle")
                    .attr("transform", function(d) {
                        return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                    })
                    .text(function(d) { return d.text; });

                // Add scroll event listener
                var animated = false;
                window.addEventListener('scroll', function() {
                    var wordcloudElement = document.getElementById('wordcloud');
                    var wordcloudPosition = wordcloudElement.getBoundingClientRect().top;
                    var screenPosition = window.innerHeight / 1.3;

                    if (wordcloudPosition < screenPosition && !animated) {
                        animateWordCloud();
                        animated = true;
                        setInterval(animateWordCloud, 3000);
                    }
                });

                function animateWordCloud() {
                    texts.transition()
                        .duration(1000)
                        .attr("transform", function(d) {
                            var newX = d.x + (Math.random() - 0.5) * 50;
                            var newY = d.y + (Math.random() - 0.5) * 50;
                            return "translate(" + [newX, newY] + ")rotate(" + d.rotate + ")";
                        })
                        .transition()
                        .duration(1000)
                        .attr("transform", function(d) {
                            return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                        });
                }
            }
        });
    }

    function createChartAndDropdown() {
        Promise.all([
            d3.json("words.json"),
            d3.json("speaker_texts.json")
        ]).then(function([wordData, textData]) {
            const text = Object.keys(wordData.TRUMP);

            // Populate dropdown
            const select = d3.select("#wordSelect")
                .selectAll("option")
                .data(text)
                .enter()
                .append("option")
                .text(d => d)
                .attr("value", d => d);

            // Set up SVG
            const margin = {top: 20, right: 20, bottom: 30, left: 40};
            const width = 600 - margin.left - margin.right;
            const height = 400 - margin.top - margin.bottom;

            const svg = d3.select("#chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Set up scales
            const x = d3.scaleBand()
                .range([0, width])
                .padding(0.1);

            const y = d3.scaleLinear()
                .range([height, 0]);

            // Add axes
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .attr("class", "x-axis");

            svg.append("g")
                .attr("class", "y-axis");

            // Function to update chart and text
            function updateChartAndText(selectedWord) {
                const chartData = [
                    {name: "Trump", value: wordData.TRUMP[selectedWord]},
                    {name: "Biden", value: wordData.BIDEN[selectedWord]}
                ];

                // Update result div
                d3.select("#trumpCount").text(wordData.TRUMP[selectedWord]);
                d3.select("#bidenCount").text(wordData.BIDEN[selectedWord]);

                // Find sentences containing the selected word
                let trumpSentences = findSentences(textData.TRUMP, selectedWord);
                let bidenSentences = findSentences(textData.BIDEN, selectedWord);

                // Update text box with found sentences
                updateTextBox(trumpSentences, bidenSentences);

                // Update chart
                x.domain(chartData.map(d => d.name));
                y.domain([0, d3.max(chartData, d => d.value)]);

                svg.select(".x-axis")
                    .call(d3.axisBottom(x));

                svg.select(".y-axis")
                    .call(d3.axisLeft(y));

                const bars = svg.selectAll(".bar")
                    .data(chartData);

                bars.enter()
                    .append("rect")
                    .attr("class", "bar")
                    .merge(bars)
                    .transition()
                    .duration(1000)
                    .attr("x", d => x(d.name))
                    .attr("y", d => y(d.value))
                    .attr("width", x.bandwidth())
                    .attr("height", d => height - y(d.value))
                    .attr("fill", (d, i) => i === 0 ? "#d30b0d" : "#013364");

                bars.exit().remove();
            }

            // Function to find sentences containing the word
            function findSentences(speeches, word) {
                let sentences = [];
                speeches.forEach(speech => {
                    let matchingSentences = speech.split('\n')
                        .filter(sentence => sentence.toLowerCase().includes(word.toLowerCase()));
                    sentences = sentences.concat(matchingSentences);
                });
                return sentences;
            }

            function updateTextBox(trumpSentences, bidenSentences) {
                // Limit sentences to 150 characters
                const limitSentence = (sentence) => sentence.length > 150 ? sentence.substring(0, 147) + '...' : sentence;

                let bidenLimitedSentences = bidenSentences.map(limitSentence);
                let trumpLimitedSentences = trumpSentences.map(limitSentence);

                let bidenContent = "BIDEN:\n" + bidenLimitedSentences.join("\n\n");
                let trumpContent = "TRUMP:\n" + trumpLimitedSentences.join("\n\n");

                d3.select("#bidenSentencesBox")
                    .text(bidenContent);

                d3.select("#trumpSentencesBox")
                    .text(trumpContent);
            }

            // Event listener for dropdown
            d3.select("#wordSelect").on("change", function() {
                updateChartAndText(this.value);
            });

            // Initial update
            updateChartAndText(text[0]);
        });
    }  

    // Call both functions when the page loads
    document.addEventListener('DOMContentLoaded', (event) => {
        createWordCloud();
        createChartAndDropdown();
    });
</script>


<body>

    <div class="header">
    <div class="header with-image-bg">
        <div class="content">
            <h1>What Was Said (and Wasn't Said) in the CNN Presidential Debate</h1>
        </div>
    </div>
    <figcaption>Biden addresses Trump directly during the debate. <a href="https://media.cnn.com/api/v1/images/stellar/prod/240628011006-52-gallery-biden-trump-cnn-debate-062724.jpg?q=w_1576,c_fill">Will Lanzoni/CNN</a></figcaption>
</div>

<br></br>
    <div class="article-body">
        <div class="byline">
            <p>By <a href="">Katrina Ventura</a></p>
        </div>
        <p>In a highly anticipated face-off, President Joe Biden and former President Donald Trump participated in their first debate of the 2024 election season on CNN in Atlanta.</p>

        <p>The debate, which was marked by a series of sharp exchanges and policy discussions, provided a glimpse into the priorities and rhetorical strategies of both candidates. A detailed analysis of the <a href="https://www.cnn.com/2024/06/27/politics/read-biden-trump-debate-rush-transcript/index.html">debate transcript</a> reveals interesting insights into their focus areas and speaking styles.</p>
        </div>

    <div class="article-body">
        <h3>Trump vs Biden Word Cloud</h3>
        <div id="wordcloud"></div>
        <figcaption>Word cloud showing the most frequently used words by Trump and Biden during the debate.</figcaption>
    </div>

    <div class="article-body">
        <h3>Key Mentions</h3>
        <p>Joe Biden spoke a total of 3580 words (excluding stop words) during the debate. His speech focused on several key issues and the number of times the word was mentioned:</p>
        <li>Jobs: 13</li>
        <li>Economy: 10</li>
        <li>Border: 9</li>
        <li>Childcare: 7</li>
        <li>Climate: 6</li>

        <p>Biden used the term "job" the most and talked about brought the conversation back to the "economy" which he mentioned 10 times.He also mentioned the word "childcare" 7 times, highlighting his focus on family issues.</p>

        <p>Notably, Biden refrained from directly referring to Trump as "Trump", instead opting to call him "this guy" 14 times, and once referred to his opponent as a child. His speech had 3 instances where parts were inaudible.</p>  
        
        <blockquote>
            TRUMP:  Let’s not act like children.
        </blockquote>
        <blockquote>
            BIDEN:  You are a child.
        </blockquote>
    </div>

<div class="article-body">
    <p>Donald Trump spoke a total of 4163 words (excluding stop words), with the following mentions:</p>
    <li>Border: 24</li>
    <li>Russia: 15</li>
    <li>China: 11</li>
    <li>Jobs: 9</li>
    <li>Taxes: 7</li>

    <p>In contrast, Trump concentrated heavily on the border, mentioning it 24 times, which underscores his focus on immigration policies—a cornerstone of his previous administration.</p> 
    
    <p>His 11 mentions of "China" also indicate a significant focus on international relations and possibly responding to ongoing critiques related to his foreign policy stance.</p>
</div>

<div class="article-body">
    <h3>Word Selector</h3>
    <div class="dropdown">
        <label for="wordSelect">Select a word: </label>
        <select id="wordSelect"></select>
    </div>
    <div class="result" id="result">
        Trump: <span id="trumpCount">0</span><br>
        Biden: <span id="bidenCount">0</span>
    </div>

    <div id="chart"></div>

    <div id="bidenSentencesBox"></div>
    <div id="trumpSentencesBox"></div>
</div>

<div class="article-body">
    <h3>Words Unsaid</h3>
    <p>On questions surrounding the ongoing conflict in Gaza, Biden said Hamas 4 times but not once uttered the word Palestinian. In addressing his government's response to the conflict, Biden talked about the ceasefire plan and talked about Israel and Netanyahu and referred to the Palestinians as innocent people.</p>

    <p>Trump on the otherhand was more engaged in discussions about Ukraine and Russia. The former president said Ukraine nearly just as much times as he said Russia. But Trump said Russia the most times during the debate as he defended himself for having been quoted in a previous <a href="https://www.theatlantic.com/politics/archive/2020/09/trump-americans-who-died-at-war-are-losers-and-suckers/615997/">article by The Atlantic</a> for referring to Americans who died in the was as 'losers and suckers'.</p>

    <blockquote>Trump: It was made up by him, just like Russia, Russia, Russia was made up, just like the 51 intelligence agents are made up, just like the new thing with the 16 economists are talking. It’s the same thing. Fifty-one intelligence agents said that the laptop was Russia disinformation. It wasn’t. That came from his son Hunter. It wasn’t Russia disinformation.</blockquote>

    <p>The first debate of the 2024 election season provided a clear contrast between Biden and Trump's priorities and rhetorical strategies. Biden focused on economic and social issues, while Trump emphasized immigration and international relations. While the words they chose to emphasize provided insight into their policy focuses, the words left unsaid were equally telling.</p>

    <p>Ultimately, while debates provide a platform for candidates to articulate their visions, the real test lies in their actions. As the election season progresses, it will be crucial to scrutinize how these verbal commitments translate into tangible policies. Actions, as the saying goes, speak louder than words, and the true measure of each candidate's commitment to their stated priorities will be seen in the steps they take to address the nation's challenges.</p>
</div>       

<div class="footer">
    <div class="content">
        <p>You can find the GitHub for this project <a href="https://github.com/katrventura/cnn-debate">here</a>.</p>
    </div>
</div>

<style>

    #wordcloud {
        margin: 0 auto;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        width: 100%;
        height: 200 px;
        justify-content: center;
    }

    .dropdown {
        margin-top: 20px;
        font-size: 20px;
    }

    #chart {
        margin: 0 auto;
        justify-content: center;
        
    }

    #bidenSentencesBox {
        width: 100%;
        height: 200 px;
        overflow-y: scroll;
        border: 10px black;
        padding: 10px;
        color: #013364;

    }
    
    #trumpSentencesBox {
        width: 100%;
        height: 200 px;
        overflow-y: scroll;
        border: 10px black;
        padding: 10px;
        color: #d30b0d;

    }
</style>

<style>
    header {
                padding: 3em 0;
                background-color: black; 
            }
    .with-image-bg {
            background-image: url('image.jpg');
            position: relative;
            background-size: cover;
            margin-bottom: 2em;

            /* Center everything inside */
            min-height: 70svh;
            display: flex;
            justify-content: center;
            align-items: center;

            /* White text with a shadow */
            color: white;
            text-shadow: 0px 0px 30px black,
                0px 0px 10px rgba(0, 0, 0, 0.5);
        }

        figcaption {
            font-size: 0.8em;
            text-align: center;
            margin-top: 0.5em;
            color: #666;
        }
    body {
                margin: 0;
                font-size: 18px;
                /* font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; */
                font-family:sans-serif, Arial, Helvetica;
                /* color: lightgrey; */
                text-rendering: optimizeLegibility;
                /* background-color: black; */
            }

    .article-body {
        max-width: 800px;
        margin-left: 20%;
        margin-right: 20%;
    }

    blockquote::before {
  content: open-quote;
}
blockquote::after {
  content: close-quote;
}
blockquote {
  quotes: "“" "”" "‘" "’";
}
    .footer {
                background: #f4f4f4;
                text-align: center;
                font-size: 0.8em;
                margin-top: 4em;
                padding: 4em 0;
            }

    /* margin on mobile */
    @media (max-width: 640px) {
                body {
                    font-size: 18px;
                }
    
                .content {
                    padding-left: 0.5em;
                    padding-right: 0.5em;
                }
            }
        
</style>
</body>
</html>